<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Binary Exploitation - Format String &#43; Buffer Overflow Vulnerability - Pwnfuzz Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="Pwnfuzz Blog" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">Pwnfuzz Blog</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Binary Exploitation - Format String &#43; Buffer Overflow Vulnerability</h1>
			
		</header>
		<div class="content post__content clearfix">
			<p>A detailed guide to use a format string vulnerability to bypass protections and use the buffer overflow vulnerability to get a shell.</p>
<!-- more -->
<h1 id="foreword">Foreword</h1>
<p>I want to write this post because while I was trying to learn more about binary exploitation, I came across this interesting challenge as this shows how a two way vulnerability would be used to bypass stack canary protection and executable stack and let you use the buffer overflow vulnerability.</p>
<blockquote>
<p>Warning: This post will be long and detailed enough, so hang in there.</p></blockquote>
<h1 id="what-is-format-string-vulnerability">What is Format String Vulnerability?</h1>
<p>At first, let&rsquo;s start as we normally would. Format string as in C used to specify the the way data is going to be printed to the screen or console. Consider the following program:-</p>

<p>Let&rsquo;s compile this:-</p>

<p>Ah, so we got a warning(intended one), let&rsquo;s run:-</p>

<p>As you can see it works fine if we give it a string or something else but as soon as we give it a hex format specifier it gives hex data. In case you&rsquo;re wondering, that hex data is an actual address from the program stack. Thus, if there&rsquo;s no format specifier in a program and the data is being printed or shown accordingly, we can use a format specifier as an input parameter to leak stack addresses for own use.</p>
<h1 id="what-is-buffer-overflow">What is Buffer Overflow?</h1>
<p>I&rsquo;m sure that most of you know what it is but still let&rsquo;s have a recap. Buffer overflow vulnerability occurs when a user gives more input than it was supposed to handle hence making the memory region to overflow by the input. If used smartly, it can be used for many gains.</p>
<p>Consider the following program:-</p>

<p>PS: It was the only simple thing I could think of.</p>
<p>So, as you can see it takes 10 characters as input and display them. Let&rsquo;s compile it and turn off the protections to make it work:</p>

<p>It&rsquo;s compiled now, time to run it:-</p>

<p>A Segementation Fault, we have a buffer overflow vulnerability here.</p>
<blockquote>
<p>Note: The Buffer Overflow program, consider it as a challenge and complete it. Go Pwn!</p></blockquote>
<h1 id="protections-on-binaries">Protections on Binaries</h1>
<p>As you saw earlier, I used some gcc flags to turn off the standard protections. This process is commonly referred to as hardening as these protections prevents the vulnerability to be exploited and hence makes it harder for us to exploit it. These protections includes:-</p>
<ul>
<li>Buffer overflow protection</li>
<li>Stack overwriting protection</li>
<li>Position independent executables (see Address space layout randomization)</li>
<li>Binary stirring (randomizing the address of basic blocks)</li>
<li>Pointer masking (protection against code injection)</li>
<li>Control flow randomization (to protect against control flow diversion)</li>
</ul>
<p>Following are the protections, we will deal with:-</p>
<h4 id="stack-canaries">Stack Canaries</h4>
<p>This method works by placing a small integer, the value of which is randomly chosen at program start, in memory just before the stack return pointer. Most buffer overflows overwrite memory from lower to higher memory addresses, so in order to overwrite the return pointer (and thus take control of the process) the canary value must also be <strong>overwritten</strong>. This value is checked to make sure it has not changed before a routine uses the return pointer on the stack.</p>
<h4 id="non-executable-stack">Non-Executable Stack</h4>
<p>Another approach to preventing stack buffer overflow exploitation is to enforce a memory policy on the stack memory region that disallows execution from the stack. This means that in order to execute shellcode from the stack an attacker must either find a way to disable the execution protection from memory, or find a way to put her/his shellcode payload in a non-protected region of memory.
Even if this were not so, there are other ways. The most damning is the so-called return to libc method for shellcode creation. In this attack the malicious payload will load the stack not with shellcode, but with a proper call stack so that execution is vectored to a chain of standard library calls, usually with the effect of disabling memory execute protections and allowing shellcode to run as normal. This works because the execution never actually vectors to the stack itself.
A variant of return-to-libc is return-oriented programming (ROP), which sets up a series of return addresses, each of which executes a small sequence of cherry-picked machine instructions within the existing program code or system libraries, sequence which ends with a return. These so-called gadgets each accomplish some simple register manipulation or similar execution before returning, and stringing them together achieves the attacker&rsquo;s ends. It is even possible to use &ldquo;returnless&rdquo; return-oriented programming by exploiting instructions or groups of instructions that behave much like a return instruction.</p>
<blockquote>
<p>This is an ongoing series on my blog.</p></blockquote>
<h1 id="main"><strong>main</strong></h1>
<p>Now, let&rsquo;s get started:-</p>
<h5 id="attached-files">Attached files:</h5>
<p><a href="/files/binary/q3">q3</a></p>
<h3 id="analysing-the-binary">Analysing the binary</h3>
<p>Let&rsquo;s analyse or reverse enginner the binary first, I&rsquo;ll be using radare2 for disassembly and IDA Pro for decompiled functions:-</p>

<p>No special function is seen here, let&rsquo;s disassemble <code>main</code>:-</p>

<p>First input is getting printed and as you can see at line <code> 0x000007d2      488d3de90000.  lea rdi, qword str.Hello    ; 0x8c2 ; &quot;Hello&quot; ; const char * s</code> there&rsquo;s no specifier at the commented string otherwise radare2 would&rsquo;ve been able to show it. And since it&rsquo;s getting printed with <code> 0x000007ea      e851feffff     call sym.imp.printf         ; int printf(const char *format)</code> instruction we know where the format string vulerability is.</p>
<p>For ease of understanding, we have a decompiled function with the help of IDA:-</p>

<h3 id="exploiting-the-binary">Exploiting the binary</h3>
<p>So, let&rsquo;s make a script to find the offset for the input on stack, who knows we might be able to get something of interest?</p>

<p>Let&rsquo;s run it:-</p>

<p>So, the addresses starting from <code>0x7f</code> are libc addresses and we have offset for our input at 8 but what are those at offset 11 and 19? Whatever it is, this is something we might need. Upon discussing this from a guy(super helpful) named Faith, he told me that it <strong>could be</strong> stack canary address. Now, if we didn&rsquo;t had a format string vulnerability then we had to bruteforce the value,luckily enough we have that vulnerability here.</p>
<p>To be more broad:-
I&rsquo;ll be using gdb-gef as we have to inspect some of the registers, et&rsquo;s break the <code>__main__</code> function:-</p>

<p>Let&rsquo;s try to check those two offsets 11 and 19 to see if it&rsquo;s the stack canary or not:-</p>
<p>At first, we need to setup a breakpoint at the instruction where the comaprison happens i.e. <code>main+164</code> and we will just give random input at second and analyse the registers.</p>

<p>Here, we have a stack canary leak which is equal to the one in <code>rcx</code> register where it&rsquo;s getting stored. So, now we need to find out the libc offset as we are now on buffer overflow stage. As we already know we need to get libc offset and from earlier that format string vulnerability was causing the libc address to leak, so it&rsquo;d be a matter of time to find it out:-</p>

<p>Using <code>vmmap</code> we get to know the address of executable and writable libc and using the address we leaked from <code>%3$lx</code> input we have the leaked libc address, we just subtracted the leak address from the <code>libc.so.6</code> address, we get the offset.</p>
<p>Time to find out the offsets for register so we we will create our final exploit:-</p>

<p>As you can see we have overwritten the canary and we have the <code>rcx</code> register offset and we have <code>rbp</code> register offset at 32 which would be <code>32 - 24 = 8</code>.</p>
<h3 id="one_gadget---the-best-tool-for-finding-one-gadget-rce-in-libcso6">One_gadget - The best tool for finding one gadget RCE in libc.so.6</h3>
<p>I can honsetly vouch for this tool, this was the first time I used it and it&rsquo;s just awesome. With this tool it was easier to find the gadgets for shell spwaning.</p>

<p>I&rsquo;ll be using the first one <code>0x4f2c5</code>. Now, it&rsquo;s time to pwn:-</p>
<h3 id="final-exploit">Final Exploit</h3>
<p>We have almost everything, now it&rsquo;s time for final exploit:-</p>
<p>Here&rsquo;s the idea, I&rsquo;ll be using the format string specifier to leak canary and libc address and then use the stack canary value to send the payload and using the libc address offset we will get the one_gadget address and we are done.</p>

<p>Running the exploit we will get shell:-</p>

<p>That was it folks, took more than I thought it would but we made it.</p>
<p>I hope you enjoyed it and learned something today. If you encountered any problem or anything relevant contact me on <a href="https://twitter.com/d4mianwayne">twitter</a></p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/pwn-fmtstr-bof-pwntools-canary/" rel="tag">pwn, fmtstr, bof, pwntools, canary</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>




			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<input class="widget-search__field" type="search" placeholder="Search…" value="" name="q" aria-label="Search…">
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="http://localhost:1313/">
	</form>
</div>
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/posts/test-post/">Test Post for Summary</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/crushftp-cve-2025-2825/">CVE 2025-2825 - CrushFTP Authentication Bypass Analysis</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/hpe-irs-cve-deep-dive/">Exploring Recent CVEs in HPE Insight Remote Support</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/ivanti-endpoint-manager-xxe-cve-2024-37397/">CVE 2024-37397 - Ivanti Endpoint Manager XXE Vulnerability</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/crushftp-cve-2024-4040/">CVE 2024-4040 - CrushFTP Server-Side Template Injection Vulnerability Analysis</a></li>
		</ul>
	</div>
</div>
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item">
				<a class="widget__link" href="/categories/ctfs/">CTFs</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/cve-analysis/">CVE Analysis</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/exploit/">Exploit</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/hackthebox/">HackTheBox</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/pwning/">Pwning</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/testing/">Testing</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/vulnhub/">Vulnhub</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/.net/" title=".NET">.NET (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ansible-playbooks-cronjob-easy-java-seasonal-spring4shell/" title="Ansible-Playbooks, Cronjob, Easy, Java, Seasonal, Spring4shell">Ansible-Playbooks, Cronjob, Easy, Java, Seasonal, Spring4shell (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/auth-bypass/" title="Auth-Bypass">Auth-Bypass (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/bash-easy-eval-python-code-injection-relative-path-exploit/" title="Bash, Easy, Eval, Python-Code-Injection, Relative-Path-Exploit">Bash, Easy, Eval, Python-Code-Injection, Relative-Path-Exploit (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/blindsqlinjection-nosql-xss-pspy64/" title="BlindSQLInjection, NoSQL, XSS, Pspy64">BlindSQLInjection, NoSQL, XSS, Pspy64 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ctf-pwn-v8-browser-pwn/" title="Ctf, Pwn, V8, Browser Pwn">Ctf, Pwn, V8, Browser Pwn (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-37297/" title="CVE-2024-37297">CVE-2024-37297 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-4040/" title="Cve-2024-4040">Cve-2024-4040 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-53675/" title="CVE-2024-53675">CVE-2024-53675 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-53676/" title="CVE-2024-53676">CVE-2024-53676 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2025-2825/" title="CVE-2025-2825">CVE-2025-2825 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/debug/" title="Debug">Debug (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dependencies-easy-pdfkit-ruby/" title="Dependencies, Easy, Pdfkit, Ruby">Dependencies, Easy, Pdfkit, Ruby (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/deserialisation/" title="Deserialisation">Deserialisation (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dll/" title="DLL">DLL (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dotnet/" title="Dotnet">Dotnet (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dstat-sqlmap-upstream_proxy-websocket/" title="Dstat, Sqlmap, Upstream_proxy, Websocket">Dstat, Sqlmap, Upstream_proxy, Websocket (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/exploit-dev-egghunting/" title="Exploit-Dev, Egghunting">Exploit-Dev, Egghunting (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/java/" title="Java">Java (3)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/libc-2.27-heap-pwn-ctf-hitcon-tcache-roppy/" title="Libc-2.27, Heap, Pwn, Ctf, Hitcon, Tcache, Roppy">Libc-2.27, Heap, Pwn, Ctf, Hitcon, Tcache, Roppy (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/logic-flaw/" title="Logic-Flaw">Logic-Flaw (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/newtonsoft/" title="NewtonSoft">NewtonSoft (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/nmap-ctf-hackthebox-htb/" title="Nmap, Ctf, HacktheBox, Htb">Nmap, Ctf, HacktheBox, Htb (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/nmap-ctf-vulnhub/" title="Nmap, Ctf, Vulnhub">Nmap, Ctf, Vulnhub (8)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/oob-xxe/" title="OOB-XXE">OOB-XXE (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/path-traversal/" title="Path Traversal">Path Traversal (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-ctf-__malloc_hook-rop-pwntools/" title="Pwn, Ctf, __Malloc_hook, Rop, Pwntools">Pwn, Ctf, __Malloc_hook, Rop, Pwntools (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-fmtstr-bof-pwntools-canary/" title="Pwn, Fmtstr, Bof, Pwntools, Canary">Pwn, Fmtstr, Bof, Pwntools, Canary (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-hackthebox-v8-kernel-heap-tcache-libc-2.29/" title="Pwn, Hackthebox, V8, Kernel, Heap, Tcache, Libc-2.29">Pwn, Hackthebox, V8, Kernel, Heap, Tcache, Libc-2.29 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-roppy-ret2dlresolve/" title="Pwn, Roppy, Ret2dlresolve">Pwn, Roppy, Ret2dlresolve (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-shellcode-egghunting-hackthebox/" title="Pwn, Shellcode, Egghunting, Hackthebox">Pwn, Shellcode, Egghunting, Hackthebox (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-tcache-libc-2.27-hackthebox/" title="Pwn, Tcache, Libc-2.27, Hackthebox">Pwn, Tcache, Libc-2.27, Hackthebox (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/python/" title="Python">Python (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/python-flask-lfi-chisel-jtr-pip3/" title="Python-Flask, LFI, Chisel, Jtr, Pip3">Python-Flask, LFI, Chisel, Jtr, Pip3 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rce/" title="RCE">RCE (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-bof-ret2csu-ctf/" title="Rop, Bof, Ret2csu, Ctf">Rop, Bof, Ret2csu, Ctf (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-bof/" title="Rop, Pwn, Bof">Rop, Pwn, Bof (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-bof-syscall-zer0ctf/" title="Rop, Pwn, Bof, Syscall, Zer0ctf">Rop, Pwn, Bof, Syscall, Zer0ctf (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-radare2-pwntools/" title="Rop, Pwn, Radare2, Pwntools">Rop, Pwn, Radare2, Pwntools (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-ret2libc-bof/" title="Rop, Pwn, Ret2libc, Bof">Rop, Pwn, Ret2libc, Bof (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/smb-windows-mssql-server-hashcat-evil-winrm-responder.py/" title="Smb, Windows, Mssql-Server, Hashcat, Evil-Winrm, Responder.py">Smb, Windows, Mssql-Server, Hashcat, Evil-Winrm, Responder.py (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/sqlmap/" title="Sqlmap">Sqlmap (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ssti/" title="SSTI">SSTI (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/test/" title="Test">Test (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/unlink-htb-pwn-heap/" title="Unlink, Htb, Pwn, Heap">Unlink, Htb, Pwn, Heap (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/web-app/" title="Web-App">Web-App (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/websocket/" title="Websocket">Websocket (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/windows-htb/" title="Windows, Htb">Windows, Htb (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/xxe/" title="XXE">XXE (2)</a>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2025 Pwnfuzz Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>