<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Exploit Dev: EggHunting Explained - Pwnfuzz Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="Pwnfuzz Blog" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">Pwnfuzz Blog</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Exploit Dev: EggHunting Explained</h1>
			
		</header>
		<div class="content post__content clearfix">
			<p>EggHunting, if simply put, is a technique in exploit development which is used to search for a specific keyword in an application memory space to further aid in the exploit if there is a length restriction. Egg in this case refers to specific keyword/pattern and “hunter” as put you’re searching in all the accessible address space to find the pattern, hence the hunt.</p>
<!-- more -->
<hr>
<p>Before we begin, we must understand the need of the egghunting technique. Consider a scenario where you are trying to exploit a buffer overflow but for some reason, you are unable to put the shellcode due to the length limitation of input (we will see this later in action). Given as an exploit developer, the end goal is always to get code execution by using any method possible.</p>
<p>Scenario like this is where creative thinking comes handy, let’s say you have another input field which can have your shellcode/payload but that buffer is not writing instruction pointer. Consider following example:</p>

<p>Here, if we were able to put our payload in <code>InputA</code> and somehow overwrite the instruction pointer to the address of <code>InputA</code> during the overflow trigger via <code>InputB</code> we can gain shellcode execution.</p>
<p>Following image shows it in a better way:</p>
<p><img src="/img/EggHunter_Fundamentals_dece99f2547e4fd99047fc6c0d40691a/egghunting-explained.png" alt="EggHunting Explained"></p>
<hr>
<p>This should clear it up but there’s always a part which confuses most is the part where this comes handy. To understand it better, we will do a hands-on practical to understand it in a deeper level. This is just to understand the fundamentals of egghunting technique so that once presented with an actual exploitation of this, it will be easier to make sense out of the overall process.</p>
<p>Now, we have following things cleared out:</p>
<ul>
<li>Egghunting is used when the buffer space is limited and we are unable to execute our shellcode directly. (Shellcode in this case refers to the one which gives us reverse shell). For example, let’s say we are able to write overwrite 1056 bytes but the EIP is being overwritten at 1000 bytes, that leaves you with just 56 bytes of space to put shellcode which will not be possible compared to the vanilla buffer overflow, hence we make use of this technique to expand our control. (Given a simple shellcode from <code>msfvenom</code> is of &gt;300 length)</li>
<li>This technique does not necessarily expects control over a second input field where our final shellcode will reside but it can also be on one single buffer but it depends how it parsed by the application and where the overflow is limited.</li>
<li>Lastly, the principle of this is to search into all the address space of the memory to find an “egg” (pattern) which we have specified and once found, it pass the identified address to the instruction pointer which will then execute the stored shellcode.</li>
</ul>
<hr>
<h3 id="analyzing-the-egghunting-shellcode">Analyzing the EggHunting Shellcode</h3>
<hr>
<p>There is a <a href="https://www.hick.org/code/skape/papers/egghunt-shellcode.pdf">well known paper</a> that explains the overall methodologies of egghunting and how it can be used, it was written by Skape. It is recommended to read it to understand two different ways the egghunting technique can be deployed but we will use the syscall technique as I prefer that and it is very simple to grasp.</p>
<p>Before we begin, I will be using the <code>NtDisplayString</code> syscall and the shellcode is supposed to work on Windows XP and the <code>0x43</code> is used to specify the <code>NtDisplayString</code> syscall. The reason we are using <code>NtDisplayString</code> is because as quoted by Skape himself: &ldquo;The <code>NtDisplayString</code> system call is typically used to display text to the blue-screen that some people are (unfortunately) all too familiar with. For the purposes of an egg hunter, however, it is abused due to the fact that its only argument is a pointer that is read from and not written to, thus making it a most desirable choice.”</p>
<p>It makes sense as <code>NtDisplayString</code> function accepts one argument which is a pointer to memory and read the string from the memory:</p>

<p>It is also a good thing to note that if this function gets a memory address which for some reason is not accessible, it will throw a <code>STATUS ACCESS VIOLATION</code> or <code>0xc0000005</code> value.</p>
<p>Here is one sample egghunting shellcode:</p>

<p>This is a classic EggHunter shellcode, assuming you know a little bit about assembly such as <code>mov</code> , <code>pop</code> and conditional jumps, there is two things that still stands out here:</p>
<ul>
<li><code>scasd</code> : This compares dword (4 bytes value) of <code>eax</code> with <code>edi</code> and sets the appropriate flags which is used for conditional jumps</li>
<li><code>int 0x2e</code> : This instruction triggers a software interrupt, in <code>x86</code> architecture the <code>0x2e</code> is associated with system call. The value <code>0x2e</code> is specified for system call, basically asking kernel to do some operation from user-mode. In simpler terms, there are specified syscalls a user can request kernel to perform and to do that one can use <code>int 0x2e</code>. There are many different syscalls that can be requested, the <code>eax</code> register holds an integer value which specifies the operation we are requesting. It is to be noted that the different integer values are assigned for different operation.</li>
</ul>
<p>Let’s just assume that we have taken a control of EIP and somehow made the execution our egghunting shellcode, now I will walk you through how it works, we will break it down:</p>
<ul>
<li><code>0x0000000000000000</code> : this line performs OR on the <code>dx</code> register with value of <code>0xfff</code> , <code>edx</code> register is here to keep track of the memory address space.</li>
<li><code>0x0000000000000005</code> : this instruction increments the value of <code>edx</code> by 1.</li>
<li><code>0x00000000000000006</code>  to <code>0x000000000000000a</code>: First off, his pushes the value of <code>edx</code> to the stack and then pushes the value <code>0x43</code> to the stack as well, then it performs <code>pop eax</code> basically making the <code>eax</code> holds the value <code>0x43</code> which is for <code>NtDisplayString</code> syscall and finally it calls <code>int 0x2e</code> performing the syscall operation.</li>
<li><code>0x000000000000000c</code>  to <code>0x000000000000000f</code>: Here, we check if the <code>al</code> register holds a value of 5 from the syscall result, if it does then it will pop the <code>edx</code> register and jump the first instruction again. By this point, it is safe to know that this is a loop where the shellcode keeps incrementing the <code>edx</code> value and checking if the value is equal to 5 or not, if it does keep continuing.</li>
</ul>
<blockquote>
<p>Note that the reason we just check 5 while the returned value is <code>0xc0000005</code> is because the <code>al</code> is a 8 bit register and refers to low-order 8 bit of eax hence it will contain <code>5</code></p></blockquote>
<ul>
<li><code>0x0000000000000011</code> to <code>0x0000000000000016</code> : Here, we are loading the value of our defined “egg” i.e. <code>w00t</code> but in little endian format (reverse order) is loaded to <code>eax</code> and then the <code>edx</code> (memroy space reference) value is moved to <code>edi</code> .</li>
<li><code>0x0000000000000018</code> to <code>0x0000000000000019</code> : Then the <code>scasd</code> instruction is called which is used to compare the <code>edi</code> and <code>eax</code> by default, hence it checks the value of our egg with whatever the value holds by <code>edi</code> ’s memory address. (remember it used <code>[edi]</code> which is for accessing the value stored at the memory pointed by <code>edi</code> ). Once the comparison is done, if the comparison fails the execution goes back to <code>inc edx</code> which increments page by <code>1</code> and the loop continues to check the access and then the values.</li>
<li><code>0x000000000000001b</code> to <code>0x000000000000001e</code> : This again checks the value hold by <code>edi</code> with our egg but is only called when the first <code>scasd</code> instruction found our <code>w00t</code> if not, it won’t even touch this piece of code but once the first <code>scasd</code> finds the egg, this  instruction will check the next 4 bytes stored after the first identified <code>w00t</code> and if the comparison returns true meaning that the next <code>w00t</code> is found, a <code>jmp edi</code> instruction is called which will make the program to jump to the memory where the egg was found successfully executing our main shellcode.</li>
</ul>
<hr>
<p>At this point you are wondering why we have two calls of <code>scasd</code> , good question. the reason being is that during the exploitation phase we write 8 bytes of pattern/egg, in this our first stage shellcode looks like:</p>

<p>Having a unique 8 byte egg helps in not having any false positive during the analysis of the memory for finding this very egg.</p>
<p>Another is why instead of using <code>scasd</code> why not go with <code>cmp</code> , there are few reasons for that, first is that when writing a shellcode a rule of thumb is that less bytes of shellcode and since we already making use of <code>eax</code> , <code>edi</code> registers and <code>scasd</code> is specifically designed to compare double words (4 bytes) and by default it checks the <code>eax</code> and <code>edi</code> which helps in achieving that because we will have less unnecessary insturctions in our shellcode. Often times, you might have to tackle with bad characters and it is very good practice to use whatever good option is there and of course, given the shellcode actually searches through the memory space, you would want the shellcode to be more efficient hence the <code>scasd</code></p>
<hr>
<p>I hope you have understood how egghunting technique works and if required, you can now write your own egghunting shellcode or use an existing one and modify it according to your need.</p>
<h3 id="references">References:</h3>
<ul>
<li><a href="http://undocumented.ntinternals.net/">http://undocumented.ntinternals.net/</a></li>
<li><a href="https://j00ru.vexillium.org/syscalls/nt/32/">https://j00ru.vexillium.org/syscalls/nt/32/</a></li>
<li><a href="https://www.hick.org/code/skape/papers/egghunt-shellcode.pdf">https://www.hick.org/code/skape/papers/egghunt-shellcode.pdf</a></li>
</ul>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/exploit-dev-egghunting/" rel="tag">exploit-dev, egghunting</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>




			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<input class="widget-search__field" type="search" placeholder="Search…" value="" name="q" aria-label="Search…">
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="http://localhost:1313/">
	</form>
</div>
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/posts/crushftp-cve-2025-2825/">CVE 2025-2825 - CrushFTP Authentication Bypass Analysis</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/hpe-irs-cve-deep-dive/">Exploring Recent CVEs in HPE Insight Remote Support</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/ivanti-endpoint-manager-xxe-cve-2024-37397/">CVE 2024-37397 - Ivanti Endpoint Manager XXE Vulnerability</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/crushftp-cve-2024-4040/">CVE 2024-4040 - CrushFTP Server-Side Template Injection Vulnerability Analysis</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/exploit-dev-egghunting/">Exploit Dev: EggHunting Explained</a></li>
		</ul>
	</div>
</div>
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item">
				<a class="widget__link" href="/categories/ctfs/">CTFs</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/cve-analysis/">CVE Analysis</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/exploit/">Exploit</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/hackthebox/">HackTheBox</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/pwning/">Pwning</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/vulnhub/">Vulnhub</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/.net/" title=".NET">.NET (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ansible-playbooks-cronjob-easy-java-seasonal-spring4shell/" title="Ansible-Playbooks, Cronjob, Easy, Java, Seasonal, Spring4shell">Ansible-Playbooks, Cronjob, Easy, Java, Seasonal, Spring4shell (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/auth-bypass/" title="Auth-Bypass">Auth-Bypass (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/bash-easy-eval-python-code-injection-relative-path-exploit/" title="Bash, Easy, Eval, Python-Code-Injection, Relative-Path-Exploit">Bash, Easy, Eval, Python-Code-Injection, Relative-Path-Exploit (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/blindsqlinjection-nosql-xss-pspy64/" title="BlindSQLInjection, NoSQL, XSS, Pspy64">BlindSQLInjection, NoSQL, XSS, Pspy64 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ctf-pwn-v8-browser-pwn/" title="Ctf, Pwn, V8, Browser Pwn">Ctf, Pwn, V8, Browser Pwn (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-37297/" title="CVE-2024-37297">CVE-2024-37297 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-4040/" title="Cve-2024-4040">Cve-2024-4040 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-53675/" title="CVE-2024-53675">CVE-2024-53675 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-53676/" title="CVE-2024-53676">CVE-2024-53676 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2025-2825/" title="CVE-2025-2825">CVE-2025-2825 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dependencies-easy-pdfkit-ruby/" title="Dependencies, Easy, Pdfkit, Ruby">Dependencies, Easy, Pdfkit, Ruby (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/deserialisation/" title="Deserialisation">Deserialisation (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dll/" title="DLL">DLL (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dotnet/" title="Dotnet">Dotnet (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dstat-sqlmap-upstream_proxy-websocket/" title="Dstat, Sqlmap, Upstream_proxy, Websocket">Dstat, Sqlmap, Upstream_proxy, Websocket (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/exploit-dev-egghunting/" title="Exploit-Dev, Egghunting">Exploit-Dev, Egghunting (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/java/" title="Java">Java (3)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/libc-2.27-heap-pwn-ctf-hitcon-tcache-roppy/" title="Libc-2.27, Heap, Pwn, Ctf, Hitcon, Tcache, Roppy">Libc-2.27, Heap, Pwn, Ctf, Hitcon, Tcache, Roppy (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/logic-flaw/" title="Logic-Flaw">Logic-Flaw (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/newtonsoft/" title="NewtonSoft">NewtonSoft (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/nmap-ctf-hackthebox-htb/" title="Nmap, Ctf, HacktheBox, Htb">Nmap, Ctf, HacktheBox, Htb (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/nmap-ctf-vulnhub/" title="Nmap, Ctf, Vulnhub">Nmap, Ctf, Vulnhub (8)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/oob-xxe/" title="OOB-XXE">OOB-XXE (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/path-traversal/" title="Path Traversal">Path Traversal (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-ctf-__malloc_hook-rop-pwntools/" title="Pwn, Ctf, __Malloc_hook, Rop, Pwntools">Pwn, Ctf, __Malloc_hook, Rop, Pwntools (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-fmtstr-bof-pwntools-canary/" title="Pwn, Fmtstr, Bof, Pwntools, Canary">Pwn, Fmtstr, Bof, Pwntools, Canary (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-hackthebox-v8-kernel-heap-tcache-libc-2.29/" title="Pwn, Hackthebox, V8, Kernel, Heap, Tcache, Libc-2.29">Pwn, Hackthebox, V8, Kernel, Heap, Tcache, Libc-2.29 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-roppy-ret2dlresolve/" title="Pwn, Roppy, Ret2dlresolve">Pwn, Roppy, Ret2dlresolve (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-shellcode-egghunting-hackthebox/" title="Pwn, Shellcode, Egghunting, Hackthebox">Pwn, Shellcode, Egghunting, Hackthebox (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-tcache-libc-2.27-hackthebox/" title="Pwn, Tcache, Libc-2.27, Hackthebox">Pwn, Tcache, Libc-2.27, Hackthebox (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/python/" title="Python">Python (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/python-flask-lfi-chisel-jtr-pip3/" title="Python-Flask, LFI, Chisel, Jtr, Pip3">Python-Flask, LFI, Chisel, Jtr, Pip3 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rce/" title="RCE">RCE (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-bof-ret2csu-ctf/" title="Rop, Bof, Ret2csu, Ctf">Rop, Bof, Ret2csu, Ctf (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-bof/" title="Rop, Pwn, Bof">Rop, Pwn, Bof (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-bof-syscall-zer0ctf/" title="Rop, Pwn, Bof, Syscall, Zer0ctf">Rop, Pwn, Bof, Syscall, Zer0ctf (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-radare2-pwntools/" title="Rop, Pwn, Radare2, Pwntools">Rop, Pwn, Radare2, Pwntools (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-ret2libc-bof/" title="Rop, Pwn, Ret2libc, Bof">Rop, Pwn, Ret2libc, Bof (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/smb-windows-mssql-server-hashcat-evil-winrm-responder.py/" title="Smb, Windows, Mssql-Server, Hashcat, Evil-Winrm, Responder.py">Smb, Windows, Mssql-Server, Hashcat, Evil-Winrm, Responder.py (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/sqlmap/" title="Sqlmap">Sqlmap (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ssti/" title="SSTI">SSTI (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/unlink-htb-pwn-heap/" title="Unlink, Htb, Pwn, Heap">Unlink, Htb, Pwn, Heap (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/web-app/" title="Web-App">Web-App (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/websocket/" title="Websocket">Websocket (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/windows-htb/" title="Windows, Htb">Windows, Htb (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/xxe/" title="XXE">XXE (2)</a>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2025 Pwnfuzz Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>