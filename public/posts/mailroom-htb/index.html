<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HackTheBox - Mailroom - Pwnfuzz Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="Pwnfuzz Blog" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">Pwnfuzz Blog</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HackTheBox - Mailroom</h1>
			
		</header>
		<div class="content post__content clearfix">
			<p>Writeup for HackTheBox&rsquo;s Mailroom machine.</p>
<!-- more -->
<p>Starting off with the <code>nmap</code> scan,  we can see that port 80 and 22 is open:</p>

<p>Performing a directory busting on the HTTP port, we see that it has multiple php files but none of them are of much interest beside <code>contact.php</code></p>

<p>The contact page accepts the a feedback message, we can try to include a XSS payload and see if it hit back to our HTTP Server:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled.png" alt=""></p>
<p>We got a hit on the HTTP Server:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_1.png" alt=""></p>
<p>Although nothing more could be done, as there was no login page or admin panel hence there is no need to manage sessions of an user due to which we cannot try to steal cookies either. Furthermore, performing a <code>vhost</code> scan, I identified that <code>git.mailroom.htb</code> exists, adding it to the <code>hosts</code> file and visiting it, we see that there is a repository named <code>staffroom</code> for a user named <code>matthew</code> , since the repository is public, we can have a look into the code:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_2.png" alt=""></p>
<p>Noticing that there is another application running on <code>staff-review-panel.mailroom.htb/</code> , accessing it directly from the browser or from my machine resulted in <code>403</code> Access Denied which probably means there’s some kind of filtering.</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_3.png" alt=""></p>
<p>Recalling that we had XSS through which we can trick the AI bot into visiting the provided link, what we can do with this, let the AI bot visit the <code>staff-review-panel.mailroom.htb/</code> and send it’s contents to our listener, this could be done with following XSS payload:</p>
<p>Now, sending the payload, we see that there is a response and it is able to access the <code>staff-review-panel.mailroom.htb</code> successfully</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_4.png" alt=""></p>
<p>Now, since we have access to the codebase of the <code>staff-review-panel.mailroom.htb</code> , we see that there is <code>auth.php</code> and it is authenticating user via <code>mongodb</code></p>
<p>The way the authentication works is, first the user provides email and password which is then checked from the collections, if it is correct a 2FA email is sent  to the user which contains the link that can be used to authenticate to the application:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_5.png" alt=""></p>
<p>There is a possibility of NoSQL injection, we can check it by sending the following payload:</p>

<p>This returned a successful response exactly but it sends a 2FA token.</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_6.png" alt=""></p>
<p>Since we do not have any way of reading mail, we can use this NoSQL injection to dump the credentials, Nikhil made the following payload script which was used to dump the <code>email</code> and <code>password</code> :</p>

<p>Running it, we successfully were able to get the password and email, although it did break in-between a lot due to free tier network and the script was modified altogether in accordance to the pattern found:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_7.png" alt=""></p>

<p>Now, we retrieved the credentials, trying to SSH into the machine as the user <code>tristan</code></p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_8.png" alt=""></p>
<p>After thorough enumeration, I did not find anything of concern beside the <code>/var/mail/tristan</code> which contained the 2FA code sent to it.</p>
<ul>
<li>Although one thing I noticed that there wasn’t any trace of applications running so far, to presume and checking the network interfaces, I came to the conclusion it might be running inside the docker.</li>
</ul>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_9.png" alt=""></p>
<p>Going back to the <code>staff-review-panel.mailroom.htb</code> , since we have the credentials and we have 2FA token access. Now, we can do dynamic port forwarding to access the  <a href="http://staff-review-panel.mailroom.htb/">http://staff-review-panel.mailroom.htb/</a> directly, now all we have to do is use the proxy and we are able to access it successfully:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_10.png" alt=""></p>
<p>Authenticating as the <code>tristan</code> user, a 2FA code was sent to him, which we can get from <code>/var/mail/tristan</code></p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_11.png" alt=""></p>

<p>Visiting the link we got with the 2FA, we can successfully access the application now:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_12.png" alt=""></p>
<p>Recalling the <code>git.mailroom.htb</code> , we saw that there was a <code>inspect.php</code> and it had <code>shell_exec</code> function call which takes either <code>inquiry_id</code> or <code>status_id</code> and it filters out some characters to mitigate the possibility of command injection via <code>preg_replace</code> but it misses the backtick character</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_13.png" alt=""></p>
<p>We can test it by capturing the request in burp suite and making a <code>nc</code> connection, to point it out, the <code>staff-review-panel.mailroom.htb</code> is running inside the docker and it was unable to make connection to my kali machine, so I used the SSH connection to connect to the <code>mailroom.htb</code> machine and used it for gaining reverse shell and testing connection:</p>

<p>It wasn’t connecting back to my kali machine but successfully making connection the mailroom machine itself, could be because of docker instance running on the machine it is unable to make any outbound connection beside the host machine itself</p>

<p>Now, since there are many filtered characters, what I did was downloading the bash script containing the reverse shell payload to the <code>staff-review-panel.mailroom.htb</code> docker</p>


<p>It downloaded the <code>shel;l.sh</code> script from the HTTP Server</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_14.png" alt=""></p>
<p>Now, we just execute the bash script:</p>

<p>Doing so, we got the reverse shell on the <code>staff-review-panel.mailroom.htb</code></p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_15.png" alt=""></p>
<p>Checking the docker filesystem, nothing much was found though the <code>/var/www/staffroom</code> had <code>.git</code> folder which had <code>config</code> file containing the credentials for the <code>matthew</code> user:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_16.png" alt=""></p>

<p>I tried to SSH as <code>matthew</code> but it resulted in failure, so from the <code>tristan</code> session, we can just do <code>su</code> to change to <code>matthew</code></p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_17.png" alt=""></p>
<p>After further enumeration, what I identified was there was <code>Personal.kdbx</code> file but we did not have master key to access the database and performing the normal enumeration did not point to any potential location containing the key, running <code>pspy</code> did reveal that there was a command being executed every often and the process is being executed by <code>matthew</code> user itself:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_18.png" alt=""></p>
<p>To check what the process was doing or what argument is passed to it, since we have <code>matthew</code> user privileges and the automated process is also ran under <code>matthew</code> , we can attach to the process and check the syscalls or inputs passed to it. To do so, we can make use of <code>strace</code> and use <code>-p</code> to specify the PID</p>

<p>Using the <code>strace</code> to attach to the automated process, I noticed following calls to <code>read</code> which was reading the master key password from the <code>stdin</code></p>

<p>After doing a bit of parsing and cleaning out, I got the key</p>

<p>Downloading the database, I accessed it via GUI (I could’ve accessed it via <code>kpcli</code> but I prefer GUI), we can see that it stores password for the sites along with the <code>root</code> user’s password:</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_19.png" alt=""></p>

<p>We can just authenticate as <code>root</code> using <code>su</code> and we got the access as <code>root</code> user</p>
<p><img src="/img/Mailroom_80349240b60d40f697ec5fe41f13d646/Untitled_20.png" alt=""></p>
<hr>



		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/blindsqlinjection-nosql-xss-pspy64/" rel="tag">BlindSQLInjection, NoSQL, XSS, pspy64</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>




			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<input class="widget-search__field" type="search" placeholder="Search…" value="" name="q" aria-label="Search…">
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="http://localhost:1313/">
	</form>
</div>
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/posts/test-post/">Test Post for Summary</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/crushftp-cve-2025-2825/">CVE 2025-2825 - CrushFTP Authentication Bypass Analysis</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/hpe-irs-cve-deep-dive/">Exploring Recent CVEs in HPE Insight Remote Support</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/ivanti-endpoint-manager-xxe-cve-2024-37397/">CVE 2024-37397 - Ivanti Endpoint Manager XXE Vulnerability</a></li>
			<li class="widget__item"><a class="widget__link" href="/posts/crushftp-cve-2024-4040/">CVE 2024-4040 - CrushFTP Server-Side Template Injection Vulnerability Analysis</a></li>
		</ul>
	</div>
</div>
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item">
				<a class="widget__link" href="/categories/ctfs/">CTFs</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/cve-analysis/">CVE Analysis</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/exploit/">Exploit</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/hackthebox/">HackTheBox</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/pwning/">Pwning</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/testing/">Testing</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/vulnhub/">Vulnhub</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/.net/" title=".NET">.NET (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ansible-playbooks-cronjob-easy-java-seasonal-spring4shell/" title="Ansible-Playbooks, Cronjob, Easy, Java, Seasonal, Spring4shell">Ansible-Playbooks, Cronjob, Easy, Java, Seasonal, Spring4shell (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/auth-bypass/" title="Auth-Bypass">Auth-Bypass (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/bash-easy-eval-python-code-injection-relative-path-exploit/" title="Bash, Easy, Eval, Python-Code-Injection, Relative-Path-Exploit">Bash, Easy, Eval, Python-Code-Injection, Relative-Path-Exploit (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/blindsqlinjection-nosql-xss-pspy64/" title="BlindSQLInjection, NoSQL, XSS, Pspy64">BlindSQLInjection, NoSQL, XSS, Pspy64 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ctf-pwn-v8-browser-pwn/" title="Ctf, Pwn, V8, Browser Pwn">Ctf, Pwn, V8, Browser Pwn (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-37297/" title="CVE-2024-37297">CVE-2024-37297 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-4040/" title="Cve-2024-4040">Cve-2024-4040 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-53675/" title="CVE-2024-53675">CVE-2024-53675 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-53676/" title="CVE-2024-53676">CVE-2024-53676 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2025-2825/" title="CVE-2025-2825">CVE-2025-2825 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/debug/" title="Debug">Debug (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dependencies-easy-pdfkit-ruby/" title="Dependencies, Easy, Pdfkit, Ruby">Dependencies, Easy, Pdfkit, Ruby (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/deserialisation/" title="Deserialisation">Deserialisation (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dll/" title="DLL">DLL (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dotnet/" title="Dotnet">Dotnet (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dstat-sqlmap-upstream_proxy-websocket/" title="Dstat, Sqlmap, Upstream_proxy, Websocket">Dstat, Sqlmap, Upstream_proxy, Websocket (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/exploit-dev-egghunting/" title="Exploit-Dev, Egghunting">Exploit-Dev, Egghunting (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/java/" title="Java">Java (3)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/libc-2.27-heap-pwn-ctf-hitcon-tcache-roppy/" title="Libc-2.27, Heap, Pwn, Ctf, Hitcon, Tcache, Roppy">Libc-2.27, Heap, Pwn, Ctf, Hitcon, Tcache, Roppy (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/logic-flaw/" title="Logic-Flaw">Logic-Flaw (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/newtonsoft/" title="NewtonSoft">NewtonSoft (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/nmap-ctf-hackthebox-htb/" title="Nmap, Ctf, HacktheBox, Htb">Nmap, Ctf, HacktheBox, Htb (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/nmap-ctf-vulnhub/" title="Nmap, Ctf, Vulnhub">Nmap, Ctf, Vulnhub (8)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/oob-xxe/" title="OOB-XXE">OOB-XXE (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/path-traversal/" title="Path Traversal">Path Traversal (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-ctf-__malloc_hook-rop-pwntools/" title="Pwn, Ctf, __Malloc_hook, Rop, Pwntools">Pwn, Ctf, __Malloc_hook, Rop, Pwntools (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-fmtstr-bof-pwntools-canary/" title="Pwn, Fmtstr, Bof, Pwntools, Canary">Pwn, Fmtstr, Bof, Pwntools, Canary (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-hackthebox-v8-kernel-heap-tcache-libc-2.29/" title="Pwn, Hackthebox, V8, Kernel, Heap, Tcache, Libc-2.29">Pwn, Hackthebox, V8, Kernel, Heap, Tcache, Libc-2.29 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-roppy-ret2dlresolve/" title="Pwn, Roppy, Ret2dlresolve">Pwn, Roppy, Ret2dlresolve (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-shellcode-egghunting-hackthebox/" title="Pwn, Shellcode, Egghunting, Hackthebox">Pwn, Shellcode, Egghunting, Hackthebox (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-tcache-libc-2.27-hackthebox/" title="Pwn, Tcache, Libc-2.27, Hackthebox">Pwn, Tcache, Libc-2.27, Hackthebox (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/python/" title="Python">Python (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/python-flask-lfi-chisel-jtr-pip3/" title="Python-Flask, LFI, Chisel, Jtr, Pip3">Python-Flask, LFI, Chisel, Jtr, Pip3 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rce/" title="RCE">RCE (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-bof-ret2csu-ctf/" title="Rop, Bof, Ret2csu, Ctf">Rop, Bof, Ret2csu, Ctf (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-bof/" title="Rop, Pwn, Bof">Rop, Pwn, Bof (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-bof-syscall-zer0ctf/" title="Rop, Pwn, Bof, Syscall, Zer0ctf">Rop, Pwn, Bof, Syscall, Zer0ctf (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-radare2-pwntools/" title="Rop, Pwn, Radare2, Pwntools">Rop, Pwn, Radare2, Pwntools (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-ret2libc-bof/" title="Rop, Pwn, Ret2libc, Bof">Rop, Pwn, Ret2libc, Bof (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/smb-windows-mssql-server-hashcat-evil-winrm-responder.py/" title="Smb, Windows, Mssql-Server, Hashcat, Evil-Winrm, Responder.py">Smb, Windows, Mssql-Server, Hashcat, Evil-Winrm, Responder.py (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/sqlmap/" title="Sqlmap">Sqlmap (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ssti/" title="SSTI">SSTI (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/test/" title="Test">Test (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/unlink-htb-pwn-heap/" title="Unlink, Htb, Pwn, Heap">Unlink, Htb, Pwn, Heap (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/web-app/" title="Web-App">Web-App (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/websocket/" title="Websocket">Websocket (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/windows-htb/" title="Windows, Htb">Windows, Htb (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/xxe/" title="XXE">XXE (2)</a>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2025 Pwnfuzz Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>