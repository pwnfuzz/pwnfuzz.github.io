<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CVE 2024-37397 - Ivanti Endpoint Manager XXE Vulnerability - Pwnfuzz Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="Pwnfuzz Blog" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">Pwnfuzz Blog</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/tags/">
				
				<span class="menu__text">Tags</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
    <article class="post">
        <header class="post__header">
            <h1 class="post__title">CVE 2024-37397 - Ivanti Endpoint Manager XXE Vulnerability</h1>
            <p class="post__subtitle">Write-Up</p>
            <div class="post__meta">
                <span class="post__author">
                    <i class="fas fa-user"></i> D4mianwayne
                </span>
                <span class="post__date">
                    <i class="far fa-calendar-alt"></i> November 24, 2024
                </span>
                
                <span class="post__categories">
                    <i class="fas fa-folder"></i>
                    
                        
                        <a href="/categories/cve-analysis">CVE Analysis</a>
                    
                </span>
                
                <span class="post__reading-time">
                    <i class="far fa-clock"></i> 6 min read
                </span>
            </div>
        </header>

        

        <div class="post__content clearfix">
            <p>This blog provides an in-depth analysis of the exploitation process for an unauthenticated XXE vulnerability in Ivanti Endpoint Manager, identified as CVE-2024-37397.</p>
<h1 id="uncovering-the-importxml-vulnerability">Uncovering the <code>ImportXml</code> Vulnerability</h1>
<hr>
<p><img src="/img/ivanti-cve-2024-37397/zdi-overview.jpg" alt=""></p>
<p>This vulnerability was identified by 06fe5fd2bc53027c4a3b7e395af0b850e7b8a044 and detailed in the ZDI advisory, which provided key information about the affected component. The advisory mentioned that the XXE vulnerability was found in the <code>ImportXml</code> function, guiding us to search for references to this specific function.</p>
<blockquote>
<p>I was able to get an evaluation copy of the Endpoint Manager using Wayback Machine, from there setup was as easy as following the prompts.</p></blockquote>
<p>Once the installation was complete, I used <code>ripgrep</code> tool to look for any references for <code>ImportXml</code> within the installed directory. Multiple instances were found in following DLLs:</p>
<p>Fortunately, these DLLs are .NET executables, we can load it into the <code>dnSpy</code> and start analyzing right way. Once loaded, we can see that there are multiple classes where <code>importXml</code> is defined and used.</p>
<p>One thing that is common in all of the <code>ImportXml</code> functions defined everywhere is that none of them explictly make the <code>XmlResolver</code>  as <code>null</code> which is a workaround for XXE vulnerabilities in .NET applications. Given that we now know which DLL has the definition for our vulnerable function, it is now time to look into which function actually calls for this function so we can trigger this for our gain.</p>
<h1 id="triggering-the-vulnerability-understanding-the-flaw">Triggering the Vulnerability: Understanding the Flaw</h1>
<p>Initially, when running <code>rg</code> again, there were no other DLLs where <code>ImportXml</code> was called. This indicated that we might be looking for a pattern where a function from the identified DLL calls ImportXml, and that function is called elsewhere. Running <code>rg</code> in this case would be time-consuming and might not yield concrete results, so we needed to move forward by understanding the different components of the application, or alternatively, by considering the paths of the identified DLLs.</p>
<p>One place where the [] DLL was found was under <em>ProvisioningWebService</em>. Given its name, this most likely suggests that a web service is being handled by the DLLs in this directory. Upon further investigation, we identified the following DLLs:</p>
<p>There is a <code>ProvisioningWebService.dll</code>, which looks promising. Loading it into dnSpy, we can see that the DLL has a class <code>ProvisioningService</code> which has multiple methods defined:</p>
<p><img src="/img/ivanti-cve-2024-37397/provisioning-service-methods.jpg" alt=""></p>
<p>Checking these methods has <code>[WebMethod]</code> attributes defined, indicating that these methods handle data from web requests.</p>
<p><img src="/img/ivanti-cve-2024-37397/webmethods-identified.jpg" alt=""></p>
<p>Looking into the imports of this class, we can see that <code>LANDesk.Provisioning.Business</code> DLL is called, given that we might be on right track of finding the source/sink pattern of our vulnerability.</p>

<p>As we observed earlier, there were no reference of <code>ImportXml</code> directly found within any DLL and <code>ProvisioningService</code> class was no different but we see that there are some methods that were defined within the <code>LANDesk.Provisioning.Business</code> are called here such as <code>PHistoryTask</code> or <code>PHistoryEntry</code>. The identified functions were <code>GetProvisioningBootOption</code> which was as following:</p>

<p>Certain things that is observable at first is the argument, we see that it takes two different arguments <code>clientMacAddress</code> and other was <code>pxeProxyMacAddress</code> which did not seem like something where we can inject some payload or try, at least from the naked eye. But that&rsquo;s where the other function named <code>SetActionStatus</code> entered in the play. Looking closer into the function we see that it indeed takes an argument of <code>actionXml</code> which seemed promising right off the bat.</p>

<p>Since this is also a <code>[WebMethod]</code> we can be cetain that this particular method can be invoked somehow from the HTTP request. Further analysis of this revealed that it calls <code>PHistoryEntry.WriteActionStatus</code> method which is defined <code>LANDesk.Provisioning.Business</code> DLL. The arguments passed into the <code>WriteActionStatus</code> is something we will take a note of when analyzing the <code>WriteActionStatus</code> class.</p>
<p>Now, when we check the <code>PHistoryEntry</code> class, we notice that there is a defined method <code>ImportXml</code> as well as our method in question <code>WriteActionStatus</code>. Checking the <code>ImportXml</code> method, we see that it takes the <code>actionXml</code> as string and later processes it via the <code>XmlDocument</code> parser. As we discussed earlier, the <code>XmlResolver</code> value is not set to <code>null</code> meaning that we have can include external DTDs and the parser here will attempt to get the definition from the DTD and perform the processing of the same.</p>

<p>But before going there, we need to check how the <code>WriteActionStatus</code> calls our <code>ImportXml</code> and how we can actually trigger our vulnerability. The <code>WriteActionStatus</code> method was defined as follows:</p>

<p>This is rather a very large function to analyze but luckily, I managed to bring it down to certain simplicity. But before that, let&rsquo;s check it&rsquo;s POST request and the actual data we have to sent to the application as part of our HTTP request. Given that we know the service is running on port 8443 and we have IIS manager insalled on our Windows Server, we can navigate within the IIS Manager and find the <code>ProvisioningWebService</code> path and then attempt to reach it from browser.</p>
<p>If you have ever come across any of the writeups related to Ivanti Endpoint Manager, you would know majority of them is done through SOAP API and this is not exception. One good thing about SOAP APIs is that it will list the methods supported by the API and give us sample request and an example response to work with.</p>
<p>Now, that we have a sample <code>SetActionStatus</code> request to work with, let&rsquo;s see how exactly we can reach our targeted function.</p>
<h3 id="overcoming-obstacles-challenges-in-exploiting-xxe">Overcoming Obstacles: Challenges in Exploiting XXE</h3>
<p>Now, let&rsquo;s dive deeper into analyzing the logic of WriteActionStatus to reach the part where the ImportXml function is called. Instead of going line by line through the code, weâ€™ll focus on the main checkpoints that lead us to ImportXml.</p>

<p>First, the <code>historyEntryIDN</code> must be valid. This kicks off a series of database lookups involving history tasks and entries. These values are retrieved based on the initial <code>historyEntryIDN</code>. If all validations pass and flag2 remains true, the next significant check involves <code>actionXml</code>. The logic behind <code>flag6</code> is simpleâ€”it checks if <code>actionXml</code> is empty. If itâ€™s not, this sets up the possibility of calling ImportXml.</p>
<p>However, before reaching that point, other conditions must be satisfied, such as ensuring the history entryâ€™s state isnâ€™t in a &ldquo;stale&rdquo; mode (like rebooting or waiting for software delivery). Provided these conditions hold true and <code>flag6</code> is set, we finally encounter the block that executes <code>ImportXml</code>. At this point, <code>flag6</code> confirms that <code>actionXml</code> contains valid data, allowing us to pass the final check and proceed with the import.</p>
<blockquote>
<p>Note: I had to make my own entries within the database to get through the check of <code>historyEntryIDN</code>. I had the ID as <code>5</code> into the database, so we will be using that in our exploit but rest assured there is a way to get through it when attacking a real target.</p></blockquote>
<h3 id="exploiting-xxe-turning-theory-into-action">Exploiting XXE: Turning Theory Into Action</h3>
<p>Now, it is time we get our hands dirty. Let&rsquo;s paste the sample request:</p>

<p>Observing the request within the Burp Suite showed a 200 response and we observe a hit on our listener:</p>
<p><img src="/img/ivanti-cve-2024-37397/xxe-showcase.jpg" alt="XXE Exploit Sample - Burp Suite"></p>
<h1 id="crafting-the-final-exploit">Crafting the Final Exploit</h1>
<p>From the previous analysis, we understood that a valid <code>historyEntryID</code> is required to perform the <code>SetActionStatus</code> action. Like most exploits, my aim was to minimize dependencies on pre-existing data. In this case, we can leverage the <code>GetTasksXml</code> method to retrieve valid IDs and use them in the <code>SetActionStatus</code> request alongside our XXE payload, leading to the final exploit.</p>
<p>The final exploit combines the <code>GetTasksXml</code> and <code>SetActionStatus</code> requests. Essentially, <code>GetTasksXml</code> retrieves the valid <code>historyEntryID</code>, which is then used in the <code>SetActionStatus</code> request containing the XXE payload. Unfortunately, at the time of writing, the installed version had a license expiration issue, making reinstallation more complex than expected. However, the final exploit can be found <a href="https://github.com/D4mianWayne/POCs/blob/main/CVE%202024-37397/CVE-2024-37397-Final-Full-Chain.py">here</a> and is also pasted below:</p>


        </div>

        
        <footer class="post__footer">
            <div class="post-tags">
                <i class="fas fa-tags"></i>
                
                    <a href="/tags/cve-2024-37297" class="tag">CVE-2024-37297</a>
                
                    <a href="/tags/.net" class="tag">.NET</a>
                
                    <a href="/tags/oob-xxe" class="tag">OOB-XXE</a>
                
                    <a href="/tags/xxe" class="tag">XXE</a>
                
            </div>
        </footer>
        
    </article>

    <div class="post-navigation">
        
            <a href="/2024/05/cve-2024-4040-crushftp-server-side-template-injection-vulnerability-analysis/" class="post-navigation__prev">
                <i class="fas fa-arrow-left"></i>
                <span>CVE 2024-4040 - CrushFTP Server-Side Template Injection Vulnerability Analysis</span>
            </a>
        
        
            <a href="/2025/01/exploring-recent-cves-in-hpe-insight-remote-support/" class="post-navigation__next">
                <span>Exploring Recent CVEs in HPE Insight Remote Support</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        
    </div>
</main>

			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<input class="widget-search__field" type="search" placeholder="Searchâ€¦" value="" name="q" aria-label="Searchâ€¦">
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="http://localhost:1313/">
	</form>
</div>
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/2025/03/cve-2025-2825-crushftp-authentication-bypass-analysis/">CVE 2025-2825 - CrushFTP Authentication Bypass Analysis</a></li>
			<li class="widget__item"><a class="widget__link" href="/2025/01/exploring-recent-cves-in-hpe-insight-remote-support/">Exploring Recent CVEs in HPE Insight Remote Support</a></li>
			<li class="widget__item"><a class="widget__link" href="/2024/11/cve-2024-37397-ivanti-endpoint-manager-xxe-vulnerability/">CVE 2024-37397 - Ivanti Endpoint Manager XXE Vulnerability</a></li>
			<li class="widget__item"><a class="widget__link" href="/2024/05/cve-2024-4040-crushftp-server-side-template-injection-vulnerability-analysis/">CVE 2024-4040 - CrushFTP Server-Side Template Injection Vulnerability Analysis</a></li>
			<li class="widget__item"><a class="widget__link" href="/2023/06/hackthebox-soccer/">HackTheBox - Soccer</a></li>
		</ul>
	</div>
</div>
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item">
				<a class="widget__link" href="/categories/cve-analysis/">CVE Analysis</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/hackthebox/">HackTheBox</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/pwning/">Pwning</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/vulnhub/">Vulnhub</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/.net/" title=".NET">.NET (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/auth-bypass/" title="Auth-Bypass">Auth-Bypass (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-37297/" title="CVE-2024-37297">CVE-2024-37297 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-4040/" title="Cve-2024-4040">Cve-2024-4040 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-53675/" title="CVE-2024-53675">CVE-2024-53675 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2024-53676/" title="CVE-2024-53676">CVE-2024-53676 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cve-2025-2825/" title="CVE-2025-2825">CVE-2025-2825 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dstat-sqlmap-upstream_proxy-websocket/" title="Dstat, Sqlmap, Upstream_proxy, Websocket">Dstat, Sqlmap, Upstream_proxy, Websocket (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/java/" title="Java">Java (3)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/logic-flaw/" title="Logic-Flaw">Logic-Flaw (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/nmap-ctf-vulnhub/" title="Nmap, Ctf, Vulnhub">Nmap, Ctf, Vulnhub (4)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/oob-xxe/" title="OOB-XXE">OOB-XXE (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/path-traversal/" title="Path Traversal">Path Traversal (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-hackthebox-v8-kernel-heap-tcache-libc-2.29/" title="Pwn, Hackthebox, V8, Kernel, Heap, Tcache, Libc-2.29">Pwn, Hackthebox, V8, Kernel, Heap, Tcache, Libc-2.29 (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pwn-tcache-libc-2.27-hackthebox/" title="Pwn, Tcache, Libc-2.27, Hackthebox">Pwn, Tcache, Libc-2.27, Hackthebox (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rce/" title="RCE">RCE (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-bof-ret2csu-ctf/" title="Rop, Bof, Ret2csu, Ctf">Rop, Bof, Ret2csu, Ctf (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-bof/" title="Rop, Pwn, Bof">Rop, Pwn, Bof (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-radare2-pwntools/" title="Rop, Pwn, Radare2, Pwntools">Rop, Pwn, Radare2, Pwntools (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rop-pwn-ret2libc-bof/" title="Rop, Pwn, Ret2libc, Bof">Rop, Pwn, Ret2libc, Bof (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ssti/" title="SSTI">SSTI (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/xxe/" title="XXE">XXE (2)</a>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2025 Pwnfuzz Blog.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>